# 环境搭建

## 参考文档

- [使用 Docker 运行 SQL Server Linux 容器映像](https://learn.microsoft.com/zh-cn/sql/linux/quickstart-install-connect-docker)
- [安装协同系统](https://open.seeyoncloud.com/v5devCTP/38/50.html)

## 安装数据库

- 使用 Docker 安装 SQL Server

```powershell
docker pull mcr.microsoft.com/mssql/server:2022-latest
docker run -e "ACCEPT_EULA=Y" -e "MSSQL_SA_PASSWORD=Sa10241024" `
   -p 1433:1433 --name mssql --hostname mssql `
   -d `
   mcr.microsoft.com/mssql/server:2022-latest
```

- 创建并设置数据库

```sql
DROP DATABASE IF EXISTS seeyon;
CREATE DATABASE seeyon COLLATE Chinese_PRC_90_CI_AI;
ALTER DATABASE seeyon SET COMPATIBILITY_LEVEL = 140;
ALTER DATABASE seeyon SET RECOVERY SIMPLE;
ALTER DATABASE seeyon SET SINGLE_USER WITH ROLLBACK IMMEDIATE;
ALTER DATABASE seeyon SET READ_COMMITTED_SNAPSHOT ON;
ALTER DATABASE seeyon SET MULTI_USER;
SELECT is_read_committed_snapshot_on FROM sys.databases WHERE name = 'seeyon';
select * FROM sys.databases;
sp_configure 'show advanced options', 1;
reconfigure;
sp_configure 'max server memory', 4096;
reconfigure;
```

## 安装协同系统

- 运行 `SeeyonA8-2Install.bat`
- 配置数据库
- 断网下一步以跳过更新检测
- 配置密码
  - sa
  - Sa10241024
  - User1024
- 等待初始化完成
- 配置端口为 8008
  - `Seeyon\A8\ApacheJetspeed\conf\SeeyonConfig.cmd`
- 配置开发模式 development=true
  - `Seeyon\A8\ApacheJetspeed\conf\web.xml`
- 配置调试 `Seeyon\A8\ApacheJetspeed\bin\catalina_custom.bat`
  - `SET CATALINA_OPTS=-server -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,address=8000,suspend=n,server=y`
- 配置开发许可 `Seeyon\A8\ApacheJetspeed\webapps\seeyon\common\js\ui\partaletindev.js`
- 登录并配置 http://localhost:8008/seeyon
  - 添加单位
  - 添加部门
  - 添加岗位
  - 添加职务
  - 添加人员
  - 分配管理员

## 其他

- 安装多个
  - 清理注册表 `HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\SEEYON`
- 自己写启动脚本

```bat
@echo off
set JPDA_ADDRESS=8000
set JPDA_TRANSPORT=dt_socket
set CATALINA_OPTS=-server -Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,address=8000,suspend=n,server=y -Xms16G -Xmx16G -Xmn2G -XX:MetaspaceSize=512M -XX:MaxMetaspaceSize=1G -XX:NewRatio=4 -XX:SurvivorRatio=8 -XX:MaxTenuringThreshold=15 -XX:+UseG1GC -XX:MaxGCPauseMillis=200 -XX:ParallelGCThreads=8 -XX:ConcGCThreads=4  
set A8_HOME=D:\Seeyon\A8
set JAVA_HOME=%A8_HOME%\jdk
set CATALINA_HOME=%A8_HOME%\ApacheJetspeed
copy /Y partaletindev.js "%CATALINA_HOME%\webapps\seeyon\common\js\ui"
cd "%CATALINA_HOME%\bin"
start catalina.bat run
```
